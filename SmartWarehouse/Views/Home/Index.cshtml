@{
    ViewBag.Title = "Dashboard";

    // --- PROGRESS BAR HESAPLAMASI ---
    var tracker = ViewBag.ModelTracker as SmartWarehouse.Models.ModelUpdateTracker;
    int mevcutSatis = tracker != null ? tracker.SalesSinceLastUpdate : 0;
    int hedefSatis = 20;

    // Yüzdeyi hesapla (Örn: 5 satış varsa %25)
    int yuzde = (int)((double)mevcutSatis / hedefSatis * 100);
    if (yuzde > 100) { yuzde = 100; }

    int kalan = hedefSatis - mevcutSatis;
    if (kalan < 0) { kalan = 0; }

    // Renk Ayarı: Az kaldıysa sarı/yeşil olsun
    string barRengi = "linear-gradient(90deg, #00d2ff 0%, #3a7bd5 100%)";
    if (yuzde >= 80)
    {
        barRengi = "linear-gradient(90deg, #11998e 0%, #38ef7d 100%)";
    }
}

<style>
    /* Dashboard Container */
    .dashboard-container {
        padding: 30px;
        background: transparent;
    }

    /* Page Header */
    .dashboard-header {
        margin-bottom: 35px;
    }

    .dashboard-title {
        font-size: 32px;
        font-weight: 700;
        color: #2d3561;
        margin: 0 0 10px 0;
        display: flex;
        align-items: center;
        gap: 15px;
    }

        .dashboard-title i {
            color: #667eea;
        }

    .dashboard-subtitle {
        color: #6c757d;
        font-size: 15px;
    }

    /* Stats Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin-bottom: 35px;
    }

    .stat-card {
        background: #fff;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
    }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(0,0,0,0.03);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

    .stat-card-content {
        position: relative;
        z-index: 1;
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        color: #fff;
        margin-bottom: 15px;
    }

    .stat-value {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 5px;
        color: #2d3561;
    }

    .stat-label {
        font-size: 14px;
        color: #6c757d;
        font-weight: 500;
        margin-bottom: 10px;
    }

    .stat-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #f1f3f5;
    }

    .stat-link {
        color: #667eea;
        font-size: 13px;
        font-weight: 600;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s ease;
    }

        .stat-link:hover {
            gap: 8px;
            text-decoration: none;
        }

    /* Card Variants */
    .stat-card-primary {
        border-left-color: #667eea;
    }

        .stat-card-primary .stat-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

    .stat-card-success {
        border-left-color: #2ecc71;
    }

        .stat-card-success .stat-icon {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

    .stat-card-warning {
        border-left-color: #f39c12;
    }

        .stat-card-warning .stat-icon {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

    .stat-card-danger {
        border-left-color: #e74c3c;
    }

        .stat-card-danger .stat-icon {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

    /* Charts Section */
    .charts-section {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 25px;
        margin-bottom: 35px;
    }

    .chart-card {
        background: #fff;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .chart-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f1f3f5;
    }

        .chart-header i {
            color: #667eea;
            font-size: 20px;
        }

    .chart-title {
        font-size: 18px;
        font-weight: 600;
        color: #2d3561;
        margin: 0;
    }

    /* Quick Actions */
    .quick-actions-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .quick-action-item {
        display: flex;
        align-items: center;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        transition: all 0.3s ease;
        text-decoration: none;
        color: #2d3561;
        background: #f8f9fa;
        border: 1px solid #e9ecef;
    }

        .quick-action-item:hover {
            background: #667eea;
            color: #fff;
            transform: translateX(5px);
            text-decoration: none;
            border-color: #667eea;
        }

    .quick-action-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-size: 18px;
        transition: all 0.3s ease;
    }

    .quick-action-item:hover .quick-action-icon {
        background: rgba(255,255,255,0.2);
        color: #fff;
    }

    .action-success .quick-action-icon {
        background: rgba(46, 204, 113, 0.1);
        color: #2ecc71;
    }

    .action-info .quick-action-icon {
        background: rgba(52, 152, 219, 0.1);
        color: #3498db;
    }

    .action-warning .quick-action-icon {
        background: rgba(243, 156, 18, 0.1);
        color: #f39c12;
    }

    .quick-action-text {
        flex: 1;
        font-weight: 500;
        font-size: 15px;
    }

    .quick-action-arrow {
        font-size: 14px;
        opacity: 0.5;
        transition: all 0.3s ease;
    }

    .quick-action-item:hover .quick-action-arrow {
        opacity: 1;
        transform: translateX(3px);
    }

    /* Responsive */
    @@media (max-width: 992px) {
        .charts-section {
            grid-template-columns: 1fr !important;
        }

        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
    }

    @@media (max-width: 576px) {
        .dashboard-container {
            padding: 20px;
        }

        .dashboard-title {
            font-size: 24px;
        }

        .stat-value {
            font-size: 28px;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Alert Messages */
    .alert-notification {
        padding: 16px 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 12px;
        animation: slideDown 0.5s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    @@keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .alert-success {
        background: #d4edda;
        border-left: 4px solid #28a745;
        color: #155724;
    }

    .alert-error {
        background: #f8d7da;
        border-left: 4px solid #dc3545;
        color: #721c24;
    }

    .alert-notification i {
        font-size: 20px;
    }

    .alert-success i {
        color: #28a745;
    }

    .alert-error i {
        color: #dc3545;
    }

    .alert-notification strong {
        font-weight: 600;
    }

    /* Tablo Stilleri */
    .table-hover tbody tr:hover {
        background-color: rgba(255,255,255,0.1);
    }
</style>

<div class="dashboard-container">

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert-notification alert-success">
            <i class="fas fa-check-circle"></i>
            <span><strong>Başarılı!</strong> @TempData["SuccessMessage"]</span>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert-notification alert-error">
            <i class="fas fa-exclamation-circle"></i>
            <span><strong>Hata!</strong> @TempData["ErrorMessage"]</span>
        </div>
    }

    <div class="dashboard-header">
        <h1 class="dashboard-title">
            <i class="fas fa-chart-line"></i>
            Dashboard
        </h1>
        <p class="dashboard-subtitle">Sistemin genel durumunu görüntüleyin</p>
    </div>

    <div class="stats-grid">

        <div class="stat-card stat-card-primary">
            <div class="stat-card-content">
                <div class="stat-icon">
                    <i class="fas fa-lira-sign"></i>
                </div>
                <div class="stat-value">@ViewBag.Ciro ₺</div>
                <div class="stat-label">Toplam Ciro</div>
                <div class="stat-footer">
                    <span class="stat-link">
                        <i class="fas fa-chart-line"></i>
                        Finansal Durum
                    </span>
                </div>
            </div>
        </div>

        <div class="stat-card stat-card-success">
            <div class="stat-card-content">
                <div class="stat-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="stat-value">@ViewBag.SatisSayisi</div>
                <div class="stat-label">Yeni Satışlar</div>
                <div class="stat-footer">
                    <a href="/Satis/Index" class="stat-link">
                        Detayları Gör
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="stat-card stat-card-warning">
            <div class="stat-card-content">
                <div class="stat-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="stat-value">@ViewBag.UrunSayisi</div>
                <div class="stat-label">Stoktaki Ürünler</div>
                <div class="stat-footer">
                    <a href="/Urun/Index" class="stat-link">
                        Ürünleri Yönet
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="stat-card stat-card-danger">
            <div class="stat-card-content">
                <div class="stat-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-value">@ViewBag.KritikStok</div>
                <div class="stat-label">Kritik Stok!</div>
                <div class="stat-footer">
                    <a href="/Urun/Index" class="stat-link">
                        Stokları İncele
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>

    </div>

    <div class="charts-section">

        <div class="chart-card">
            <div class="chart-header">
                <i class="fas fa-chart-pie"></i>
                <h3 class="chart-title">Kategori Bazlı Ürün Dağılımı</h3>
            </div>
            <div class="chart-body">
                <canvas id="kategoriGrafik"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <i class="fas fa-bolt"></i>
                <h3 class="chart-title">Hızlı İşlemler</h3>
            </div>
            <div class="quick-actions">
                <ul class="quick-actions-list">
                    <li>
                        <a href="/Satis/YeniSatis" class="quick-action-item action-success">
                            <div class="quick-action-icon">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <span class="quick-action-text">Yeni Satış Yap</span>
                            <i class="fas fa-arrow-right quick-action-arrow"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/Urun/Create" class="quick-action-item action-info">
                            <div class="quick-action-icon">
                                <i class="fas fa-box-open"></i>
                            </div>
                            <span class="quick-action-text">Yeni Ürün Ekle</span>
                            <i class="fas fa-arrow-right quick-action-arrow"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/Musteri/Create" class="quick-action-item action-warning">
                            <div class="quick-action-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <span class="quick-action-text">Yeni Müşteri Ekle</span>
                            <i class="fas fa-arrow-right quick-action-arrow"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/Kategori/Create" class="quick-action-item action-info">
                            <div class="quick-action-icon">
                                <i class="fas fa-tags"></i>
                            </div>
                            <span class="quick-action-text">Yeni Kategori Ekle</span>
                            <i class="fas fa-arrow-right quick-action-arrow"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

    </div>

    <div class="charts-section" style="grid-template-columns: 1fr 1fr;">

        <div class="chart-card" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); color: #fff; border: none;">
            <div class="chart-header" style="border-bottom-color: rgba(255,255,255,0.2);">
                <i class="fas fa-robot"></i>
                <h3 class="chart-title" style="color: #fff;">Gelecek Ay Tahminleri (Top 5)</h3>
            </div>

            <div style="padding: 10px 0;">
                @if (ViewBag.TahminListesi != null && ((List<SmartWarehouse.Controllers.HomeController.TahminSonuc>)ViewBag.TahminListesi).Count > 0)
                {
                    <div class="table-responsive">
                        <table class="table table-borderless text-white mb-0" style="font-size: 0.9rem;">
                            <thead style="border-bottom: 2px solid rgba(255,255,255,0.3);">
                                <tr style="height: 45px;">
                                    <th style="padding: 12px 8px;">Ürün</th>
                                    <th style="padding: 12px 8px;">Stok</th>
                                    <th style="padding: 12px 8px;">Tahmin</th>
                                    <th style="padding: 12px 8px;">Durum</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in (List<SmartWarehouse.Controllers.HomeController.TahminSonuc>)ViewBag.TahminListesi)
                                {
                                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); height: 50px;">
                                        <td style="padding: 12px 8px;"><i class="fas fa-box-open mr-2"></i> @item.UrunAdi</td>
                                        <td style="padding: 12px 8px;">@item.StokDurumu</td>
                                        <td style="padding: 12px 8px; font-weight:bold; font-size:1.1em;">@item.TahminEdilenSatis</td>
                                        <td style="padding: 12px 8px;">
                                            @if (item.StokDurumu < item.TahminEdilenSatis)
                                            {
                                                <span class="badge badge-danger p-2"><i class="fas fa-exclamation-triangle"></i> Yetersiz</span>
                                            }
                                            else
                                            {
                                                <span class="badge badge-success p-2"><i class="fas fa-check"></i> Yeterli</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center py-5">
                        <div class="spinner-border text-light" role="status" style="width: 3rem; height: 3rem;">
                            <span class="sr-only">Yükleniyor...</span>
                        </div>
                        <p class="mt-3">Yapay Zeka analizi hazırlanıyor...</p>
                    </div>
                }
            </div>

            <div style="margin-top: 15px; font-size: 11px; opacity: 0.7; text-align: right;">
                <i class="fas fa-info-circle"></i> Son 30 günlük trendlere göre hesaplanmıştır.
            </div>
        </div>

        <!-- AI Model Durumu Kartı -->
        <div class="chart-card" style="background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color: #fff; border: none;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <i class="fas fa-brain" style="font-size: 2.5em; opacity: 0.9;"></i>
                <div>
                    <h3 style="margin: 0; font-size: 1.2em; font-weight: 600;">AI Model Durumu</h3>
                    <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9em;">Otomatik Öğrenme Sistemi</p>
                </div>
            </div>

            @if (tracker != null)
            {
                <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="font-size: 0.9em;">Son Güncelleme:</span>
                        <strong>@tracker.LastUpdateDate.ToString("dd.MM.yyyy HH:mm")</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="font-size: 0.9em;">Toplam Veri:</span>
                        <strong>@tracker.TotalSalesUsed satış</strong>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 0.85em;">Eğitim İlerlemesi</span>
                        <span style="font-size: 0.85em; font-weight: 600;">@mevcutSatis / @hedefSatis</span>
                    </div>
                    <div style="background: rgba(255,255,255,0.3); height: 20px; border-radius: 10px; overflow: hidden;">
                        <div style="background: @barRengi; height: 100%; width: @yuzde%; transition: width 0.5s ease;"></div>
                    </div>
                    <p style="margin: 10px 0 0 0; font-size: 0.85em; opacity: 0.9; text-align: center;">
                        @if (kalan > 0)
                        {
                            <text>🔄 <strong>@kalan</strong> satış sonra model otomatik güncellenecek</text>
                        }
                        else
                        {
                            <text>✅ Model hazır güncelleniyor...</text>
                        }
                    </p>
                </div>

                <!-- Bilgilendirme -->
                <div style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 0.8em; opacity: 0.85; text-align: center;">
                    <i class="fas fa-info-circle"></i>
                    Sistem her 20 satışta otomatik olarak kendini günceller
                </div>
            }
            else
            {
                <div class="text-center py-4">
                    <div class="spinner-border text-light" role="status">
                        <span class="sr-only">Yükleniyor...</span>
                    </div>
                    <p class="mt-3" style="font-size: 0.9em;">Model bilgileri yükleniyor...</p>
                </div>
            }
        </div>

    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var kategoriIsimleri = @Html.Raw(Json.Encode(ViewBag.KategoriIsimleri));
    var urunSayilari = @Html.Raw(Json.Encode(ViewBag.KategoriUrunSayilari));

    var ctx = document.getElementById('kategoriGrafik').getContext('2d');
    var myPieChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: kategoriIsimleri,
            datasets: [{
                data: urunSayilari,
                backgroundColor: [
                    '#667eea',
                    '#764ba2',
                    '#f093fb',
                    '#4facfe',
                    '#43e97b',
                    '#fa709a'
                ],
                borderWidth: 3,
                borderColor: '#fff',
                hoverOffset: 15,
                hoverBorderWidth: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        font: {
                            size: 13,
                            weight: '500'
                        },
                        usePointStyle: true,
                        pointStyle: 'circle'
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    padding: 12,
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 13
                    },
                    borderColor: '#667eea',
                    borderWidth: 1,
                    displayColors: true,
                    callbacks: {
                        label: function(context) {
                            var label = context.label || '';
                            var value = context.parsed || 0;
                            var total = context.dataset.data.reduce((a, b) => a + b, 0);
                            var percentage = ((value / total) * 100).toFixed(1);
                            return label + ': ' + value + ' ürün (' + percentage + '%)';
                        }
                    }
                }
            },
            animation: {
                animateRotate: true,
                animateScale: true,
                duration: 1500,
                easing: 'easeInOutQuart'
            }
        }
    });
</script>